<h1>List of users</h1>

<table border="1">
  <tr>
    <th>
      Username
    </th>

    <th>
      Private?
    </th>

    <th></th>
    <th></th>
  </tr>
<% @user.each do |user| %>
  <tr>
    <td><%= user.username %></td>
    <% if user.private == true %>
      <td>Yes</td>
    <% else %>
      <td>No</td>
    <% end %>
    <% if session.fetch(:user_id) != nil %>
      <% following = FollowRequest.where(sender_id: user.id) %>
      <% follow_request = FollowRequest.where(sender_id: user.id, status: "pending") %>
      <% if following %>
        <td>
          <a href="/delete_follow_request/2138">
            Unfollow
          </a>
        </td>
      <% elsif user.private == true && follow_request %>
        <td>
          <p>Request sent. <a href="/delete_follow_request/2138">Cancel</a></p>
        </td>
      <% elsif user.private == false %> 
        <td>
          <form action="/users/<%= user.username %>">
            <input type="hidden" name="query_recipient_id" value="<%= user.id %>">
            <td>
              <button>
                Follow
              </button>
            </td>
          </form>
        </td>
      <% else %>
        <td>
          <form action="/insert_follow_request" method="post">
            <input type="hidden" name="query_recipient_id" value="<%= user.id %>">
            <td>
              <button>
                Follow
              </button>
            </td>
          </form>
        </td>
      <% end %>
    <% end %>
    <td><a href="users/<%= user.username %>">Show details</a></td>
  </tr>
<% end %>

  </table>
